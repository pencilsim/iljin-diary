<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì§„ì¼ê¸° MVP v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #334155; }
        .tab-btn { padding-bottom: 4px; border-bottom: 2px solid transparent; color: #94a3b8; transition: all 0.2s; cursor: pointer; }
        .tab-btn.active { border-bottom: 2px solid #6366f1; color: #6366f1; font-weight: bold; }
        .mood-selected { background-color: #eef2ff; border: 2px solid #6366f1; transform: scale(1.1); }
        .month-chip { padding: 4px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; border: 1px solid #e2e8f0; background: white; }
        .month-chip.active { background: #6366f1; color: white; border-color: #6366f1; }
        .ai-box { position: relative; border-radius: 20px; background: linear-gradient(145deg, #ffffff, #f1f5f9); border: 1px solid #e2e8f0; }
        .ai-box::before { content: 'MENTOR'; position: absolute; top: -10px; left: 20px; background: #6366f1; color: white; font-size: 9px; font-weight: 900; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="app" class="max-w-5xl mx-auto min-h-screen flex flex-col shadow-2xl bg-white">
    <!-- í—¤ë” -->
    <header class="px-8 py-6 flex justify-between items-center border-b sticky top-0 bg-white z-30">
        <h1 class="text-xl font-black text-indigo-600 tracking-tighter cursor-pointer" onclick="location.reload()">æ—¥è¾°æ—¥è¨˜</h1>
        <nav class="flex gap-8 text-sm font-bold">
            <button id="tabToday" class="tab-btn active">ì˜¤ëŠ˜ì˜ ê¸°ë¡</button>
            <button id="tabList" class="tab-btn">ë‚˜ì˜ ë³´ê´€ì†Œ</button>
            <button id="tabSetting" class="tab-btn">ë‚´ ì„¤ì •</button>
        </nav>
    </header>

    <!-- ëª…ì‹ ë°” -->
    <div class="bg-slate-50 px-8 py-3 border-b flex justify-between items-center text-[11px]">
        <div class="flex gap-4">
            <span class="text-gray-400 font-bold uppercase tracking-widest">Master Saju</span>
            <span id="displaySaju" class="font-bold text-slate-700">ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>
        </div>
        <div id="displayZodiac" class="bg-white border px-3 py-1 rounded-full text-indigo-600 font-black">-</div>
    </div>

    <!-- 1. ì˜¤ëŠ˜ì˜ ê¸°ë¡ íƒ­ -->
    <main id="viewToday" class="p-8 space-y-8 block">
        <section class="flex flex-col gap-6">
            <div class="flex justify-between items-center">
                <input type="date" id="datePicker" class="p-2 border-none bg-slate-100 rounded-lg text-sm font-bold outline-none focus:ring-2 ring-indigo-500">
                <div class="flex gap-4">
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Year</p><h3 id="shinsalYear" class="text-xs font-bold text-slate-500">-</h3></div>
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Month</p><h3 id="shinsalMonth" class="text-xs font-bold text-slate-500">-</h3></div>
                    <div class="text-center px-4 border-l"><p class="text-[9px] text-indigo-500 font-black uppercase">Today</p><h3 id="shinsalDay" class="text-sm font-black text-indigo-600">-</h3></div>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- ì¼ê¸° ì‘ì„± -->
            <section class="space-y-6">
                <div>
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-tighter mb-4">Daily Observation</h3>
                    <textarea id="diaryText" class="w-full h-52 p-6 bg-slate-50 rounded-3xl outline-none focus:ring-2 ring-indigo-100 text-sm leading-relaxed border-none shadow-inner" placeholder="ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”? ì–´ë–¤ ê¸°ìš´ì´ ë‹¹ì‹ ì„ ì›€ì§ì˜€ë‚˜ìš”?"></textarea>
                </div>
                <div class="flex justify-between items-center">
                    <div id="moodButtons" class="flex gap-3">
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜„">ğŸ˜„</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ™‚">ğŸ™‚</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜">ğŸ˜</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜”">ğŸ˜”</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl text-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜«">ğŸ˜«</button>
                    </div>
                    <button id="saveBtn" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-indigo-700 shadow-xl shadow-indigo-100 transition-all">ì €ì¥ ë° ë³µê¸°</button>
                </div>
            </section>

            <!-- í•™ìŠµ ê°€ì´ë“œ & ë…¸íŠ¸ -->
            <section id="insightSection" class="flex flex-col space-y-6 transition-all opacity-40">
                <div class="ai-box p-7">
                    <div id="aiComment" class="text-sm text-slate-600 leading-relaxed font-medium">
                        ì¼ê¸°ë¥¼ ì €ì¥í•˜ì‹œë©´ ì˜¤ëŠ˜ì˜ ì‹ ì‚´ê³¼ ì¼ìƒì„ ì—°ê²°í•œ ëª…ë¦¬ ê°€ì´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                    <div id="youtubeSection" class="mt-4 hidden border-t pt-4">
                        <a id="youtubeLink" target="_blank" class="text-[11px] text-red-500 font-bold hover:underline">ğŸ“º ì´ ê¸€ìì˜ ì›ë¦¬ ì‹¬í™” í•™ìŠµ</a>
                    </div>
                </div>

                <div class="bg-indigo-50/50 p-7 rounded-3xl border border-indigo-100 border-dashed">
                    <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-3">My Study Note</h3>
                    <textarea id="studyMemo" class="w-full h-40 bg-transparent border-none outline-none text-sm leading-relaxed placeholder:text-indigo-200" placeholder="ìœ„ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì˜¤ëŠ˜ ë°œê²¬í•œ ë‚˜ë§Œì˜ íŒ¨í„´ì„ ê¸°ë¡í•´ë³´ì„¸ìš”."></textarea>
                    <p class="text-[10px] text-indigo-300 italic mt-2">ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ ë…¸íŠ¸ë„ í•¨ê»˜ ë³´ê´€ë©ë‹ˆë‹¤.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- ë³´ê´€ì†Œ íƒ­ -->
    <main id="viewList" class="p-8 hidden space-y-6">
        <div class="flex justify-between items-center">
            <h2 class="font-bold text-gray-800 text-lg">ê¸°ë¡ ì•„ì¹´ì´ë¸Œ</h2>
            <button id="downloadCsv" class="text-xs font-bold text-white bg-slate-800 px-5 py-2 rounded-xl">CSV Download</button>
        </div>
        <div id="monthFilter" class="flex gap-2 overflow-x-auto pb-4 scrollbar-hide">
            <button class="month-chip active" data-month="all">ì „ì²´</button>
        </div>
        <div id="historyGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12"></div>
    </main>

    <!-- ì„¤ì • íƒ­ -->
    <main id="viewSetting" class="p-8 hidden">
        <div class="max-w-md mx-auto bg-slate-50 p-10 rounded-[40px] border shadow-sm space-y-8">
            <div class="text-center">
                <h2 class="font-black text-slate-800 text-xl">ì‚¬ì£¼ ëª…ì‹ ì„¤ì •</h2>
                <p class="text-xs text-slate-400 mt-2">ì •í™•í•œ ì‹ ì‚´ ê³„ì‚°ì„ ìœ„í•´ ì¶œìƒ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            </div>
            <div class="space-y-4">
                <div class="group">
                    <label class="text-[10px] font-bold text-slate-400 ml-2">ìƒë…„ì›”ì¼</label>
                    <input type="date" id="birthDate" class="w-full p-4 mt-1 bg-white rounded-2xl border-none outline-none focus:ring-2 ring-indigo-500 shadow-sm">
                </div>
                <div class="group">
                    <label class="text-[10px] font-bold text-slate-400 ml-2">íƒœì–´ë‚œ ì‹œê°„</label>
                    <input type="time" id="birthTime" class="w-full p-4 mt-1 bg-white rounded-2xl border-none outline-none focus:ring-2 ring-indigo-500 shadow-sm">
                </div>
                <button id="saveSettingBtn" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold shadow-lg shadow-indigo-100 mt-4">ì •ë³´ ì—…ë°ì´íŠ¸</button>
            </div>
        </div>
    </main>
</div>

<script>
    // --- ëª…ë¦¬ ìœµí•© ë°ì´í„° ---
    const JI = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"];
    const SHINSAL_LIST = ["ì§€ì‚´", "ë…„ì‚´", "ì›”ì‚´", "ë§ì‹ ì‚´", "ì¥ì„±ì‚´", "ë°˜ì•ˆì‚´", "ì—­ë§ˆì‚´", "ìœ¡í•´ì‚´", "í™”ê°œì‚´", "ê²ì‚´", "ì¬ì‚´", "ì²œì‚´"];
    
    // ë¬¸ì„œ + ëª…ë¦¬ ì§€ì‹ ìœµí•© ì½”ë©˜íŠ¸
    const SHINSAL_INSIGHTS = {
        "ê²ì‚´": "ì˜¤ëŠ˜ì€ ì‚¼í•©ì˜ ê¶¤ì ì´ ëë‚˜ê³  'ì êµ°'ì—ê²Œ ê¸°ìš´ì„ ê°•í•˜ê²Œ ì••ë°•ë°›ëŠ” ì‹œì ì…ë‹ˆë‹¤. ë‚´ ì˜ì§€ì™€ ìƒê´€ì—†ì´ ë¬´ì–¸ê°€ë¥¼ ë‚´ì–´ì£¼ê±°ë‚˜ ê°•í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ëª…ë¦¬í•™ì ìœ¼ë¡œ ìƒˆë¡œìš´ ìˆœí™˜ì„ ìœ„í•´ ê¸°ì¡´ì˜ ê²ƒì„ ì²­ì‚°í•˜ëŠ” ê³¼ì •ì´ë‹ˆ, ì–µì§€ë¡œ ë²„í‹°ê¸°ë³´ë‹¤ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í–ˆëŠ”ì§€ ë³µê¸°í•´ë³´ì„¸ìš”.",
        "ì¬ì‚´": "ì êµ°ì—ê²Œ ì™„ì „íˆ í¬ìœ„ëœ 'ì¬ì•™'ì˜ í˜•êµ­ì…ë‹ˆë‹¤. ë‚´ê°€ ì£¼ë„ì ìœ¼ë¡œ ì›€ì§ì´ë©´ ì˜¤íˆë ¤ í™”ë¥¼ ì…ì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ê¾€(ì¬ì¹˜)ë¥¼ ì¨ì„œ ìƒí™©ì„ ëª¨ë©´í•´ì•¼ í•˜ëŠ” ë‚ ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ í–‰ë™ì´ ì •ë©´ ìŠ¹ë¶€ì˜€ë‚˜ìš”, ì•„ë‹ˆë©´ ì˜ë¦¬í•œ íšŒí”¼ì˜€ë‚˜ìš”?",
        "ì²œì‚´": "í•˜ëŠ˜ì„ ìš°ëŸ¬ëŸ¬ë³´ë©° ì„¸ì›”ì„ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì‚¼í•©ì˜ ë°˜ëŒ€ ê¸°ìš´ì´ ì •ì ì— ë‹¬í•´ ìˆì–´ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤. 'ë‚´ ë§˜ëŒ€ë¡œ ì•ˆ ë˜ëŠ” í•˜ë£¨'ì˜€ë‹¤ë©´ ê·¸ê²ƒì´ ë°”ë¡œ ì²œì‚´ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. ìˆ˜ìš©í•˜ëŠ” íƒœë„ë¥¼ ê³µë¶€í•´ë³´ì„¸ìš”.",
        "ì§€ì‚´": "ë“œë””ì–´ ì§€ìƒì— ë°œì„ ë”›ê³  ìì‹ ì˜ ê¸°ìš´ì„ ë“œëŸ¬ë‚´ëŠ” 'ì¥ìƒ'ì˜ ì‹œê¸°ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì œì•ˆì´ë‚˜ ì´ë™ì˜ ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤. ì êµ°ì„ í”¼í•´ ìƒˆë¡œìš´ ê·¼ê±°ì§€ë¥¼ ë§ˆë ¨í•˜ë“¯, ì˜¤ëŠ˜ ë‹¹ì‹ ì´ ìƒˆë¡­ê²Œ ì‹œì‘í•œ ì¼ì´ ìˆë‹¤ë©´ ê·¸ê²ƒì´ ì§€ì‚´ì˜ ë°œí˜„ì…ë‹ˆë‹¤.",
        "ë…„ì‚´": "íƒ€ì¸ì˜ ì£¼ëª©ì„ ë°›ëŠ” 'ë„í™”'ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. ëª©ìš•(æ²ìš•)í•˜ë“¯ ë•Œë¥¼ ë²—ê¸°ê³  ìì‹ ì„ ë“œëŸ¬ë‚´ì•¼ í•˜ê¸°ì— ì• ì • ë¬¸ì œë‚˜ êµ¬ì„¤ìˆ˜ê°€ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì€ ì£¼ì¸ê³µì´ì—ˆë‚˜ìš”, ì•„ë‹ˆë©´ ê´€ì°°ìì˜€ë‚˜ìš”?",
        "ì›”ì‚´": "ë‚¨ì˜ í¬ìƒì´ë‚˜ ì£¼ë³€ì˜ ì •ì²´ ì†ì—ì„œ ëœ»ë°–ì˜ ì´ìµ(ê³ ë‚œ ì†ì˜ ë‹¬ë¹›)ì„ ì–»ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë‚´ê°€ ì˜í•´ì„œë¼ê¸°ë³´ë‹¤ í™˜ê²½ì  ìš”ì¸ìœ¼ë¡œ ëª¨ì–‘ìƒˆë¥¼ ê°–ì¶”ê²Œ ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ ì–»ì€ ì‘ì€ í–‰ìš´ì´ ëˆ„êµ¬ì˜ ë•ì´ì—ˆëŠ”ì§€ ìƒê°í•´ë³´ì„¸ìš”.",
        "ë§ì‹ ì‚´": "ê¸°ìš´ì´ ê±´ë¡ì— ì´ë¥´ëŸ¬ ëŒ€ë†“ê³  ë°–ìœ¼ë¡œ ë“œëŸ¬ë‚˜ëŠ” ì‹œì ì…ë‹ˆë‹¤. ìì‹ ê°ì´ ë„˜ì³ ê³¼í•˜ê²Œ í–‰ë™í•˜ë‹¤ ì‹¤ìˆ˜ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ 'ì†”ì§í•¨'ì´ ë“ì´ ë˜ì—ˆë‚˜ìš”, ì•„ë‹ˆë©´ ë§ì‹ ì´ ë˜ì—ˆë‚˜ìš”?",
        "ì¥ì„±ì‚´": "ì‚¼í•© ê¸°ìš´ì˜ ì •ì ì¸ 'ì œì™•'ì˜ ë‚ ì…ë‹ˆë‹¤. ì¥ìˆ˜ê°€ êµ°ëŒ€ë¥¼ ê±°ëŠë¦¬ë“¯ ì£¼ë„ê¶Œì„ ì¥ê³  ì„¸ìƒì„ í˜¸ë ¹í•˜ëŠ” ê¸°ìš´ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì´ ë‚´ë¦° ê²°ì •ë“¤ì€ ê°•ë ¥í–ˆë‚˜ìš”? ì£¼ë„ê¶Œì„ ì¥” ìì˜ ì±…ì„ê°ì„ ëŠê»´ë³´ì„¸ìš”.",
        "ë°˜ì•ˆì‚´": "ì „ìŸì—ì„œ ìŠ¹ë¦¬í•˜ê³  ë§ ì•ˆì¥ì— ì˜¬ë¼ ì „ë¦¬í’ˆì„ ì±™ê¸°ëŠ” 'ì‡ (è¡°)'ì˜ ì‹œê¸°ì…ë‹ˆë‹¤. ì¥ì„±ì‚´ì˜ ê²©ë ¬í•œ íˆ¬ìŸ ëì— ì–»ëŠ” í‰ì˜¨í•¨ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ìœ ë… ë§ˆìŒì´ í¸ì•ˆí•˜ê³  ì‹¤ì†ì´ ìˆì—ˆë‹¤ë©´ ë°˜ì•ˆì˜ ë•ì…ë‹ˆë‹¤. ì•„ë˜ ë…¸íŠ¸ì— ê·¸ ì„±ì·¨ë¥¼ ê¸°ë¡í•˜ì„¸ìš”.",
        "ì—­ë§ˆì‚´": "ë‹¤ì‹œ ì êµ°ì´ ì³ë“¤ì–´ì˜¤ë‹ˆ ê¸‰íˆ ì´ë™í•´ì•¼ í•˜ëŠ” 'ë³‘(ç—…)'ì˜ ì‹œê¸°ì…ë‹ˆë‹¤. ì˜ˆì „ì˜ ì—­ë§ˆê°€ ë„ë§ì´ì—ˆë‹¤ë©´ í˜„ëŒ€ëŠ” ê°œì²™ê³¼ í™•ì¥ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë¶„ì£¼í•˜ê²Œ ì›€ì§ì¸ ë™ì„ ì´ ë‹¹ì‹ ì˜ ì˜í† ë¥¼ ë„“í˜”ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.",
        "ìœ¡í•´ì‚´": "ì‚¬ë°©ì—ì„œ í•´ë¡œìš´ ê¸°ìš´ì´ ë‹¥ì³ ì˜ˆë¯¼í•´ì§€ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ê¸°ìš´ì´ ì‡ ì•½í•´ì ¸ ì •ì‹ ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ ì§ˆë³‘ì— ë…¸ì¶œë˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ì˜ˆë¯¼í•¨ì´ ì–´ë””ë¥¼ í–¥í–ˆëŠ”ì§€, í˜¹ì‹œ ìœ¡ì²´ë³´ë‹¤ ì •ì‹ ì´ ì•ì„œì§€ ì•Šì•˜ëŠ”ì§€ ë³µê¸°í•´ë³´ì„¸ìš”.",
        "í™”ê°œì‚´": "í™”ë ¤í–ˆë˜ ë¶ˆê½ƒì„ ë‹«ê³  ì°½ê³ (å¢“)ì— ê°€ë‘ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì˜¬ ìˆœí™˜ì„ ìœ„í•´ ì§ì„ ì •ë¦¬í•˜ê³  ê³¼ê±°ë¥¼ íšŒìƒí•˜ë©° ì˜ˆìˆ ì  ê°ìˆ˜ì„±ì— ì –ê¸° ì¢‹ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ë‹¹ì‹ ì´ ì •ë¦¬í•œ ìƒê°ì´ë‚˜ ë¬¼ê±´ì€ ë¬´ì—‡ì¸ê°€ìš”?"
    };

    let state = {
        date: new Date().toISOString().split('T')[0],
        userZodiac: localStorage.getItem('userZodiac') || '',
        userSaju: localStorage.getItem('userSaju') || '',
        currentMood: '',
        filterMonth: 'all'
    };

    // --- í•µì‹¬ ì—”ì§„ ---
    function getAccurateGanji(dateStr) {
        const date = new Date(dateStr);
        const base = new Date('2026-01-24'); 
        const diff = Math.round((date - base) / 86400000);
        return { 
            yearJi: JI[(6 + (date.getFullYear() - 2026) % 12 + 12) % 12],
            monthJi: JI[(date.getMonth() + 1) % 12],
            dayJi: JI[(10 + (diff % 12) + 12) % 12]
        };
    }

    function calculateShinsal(basisJi, targetJi) {
        if(!basisJi) return "-";
        const groups = { 'í•´':['í•´','ë¬˜','ë¯¸'], 'ì¸':['ì¸','ì˜¤','ìˆ '], 'ì‚¬':['ì‚¬','ìœ ','ì¶•'], 'ì‹ ':['ì‹ ','ì','ì§„'] };
        let startJi = '';
        for(let k in groups) if(groups[k].includes(basisJi)) startJi = k;
        const startIdx = JI.indexOf(startJi);
        const targetIdx = JI.indexOf(targetJi);
        return SHINSAL_LIST[(targetIdx - startIdx + 12) % 12];
    }

    // --- UI ë¡œì§ ---
    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab'+tab.charAt(0).toUpperCase()+tab.slice(1)));
        document.getElementById('viewToday').classList.toggle('hidden', tab !== 'today');
        document.getElementById('viewList').classList.toggle('hidden', tab !== 'list');
        document.getElementById('viewSetting').classList.toggle('hidden', tab !== 'setting');
        if(tab === 'list') renderHistory();
        if(tab === 'today') loadToday();
    }

    function loadToday() {
        const diaryData = JSON.parse(localStorage.getItem(`iljin:diary:${state.date}`)) || { text: '', mood: '' };
        const studyData = JSON.parse(localStorage.getItem(`iljin:study:${state.date}`)) || { memo: '' };
        
        document.getElementById('diaryText').value = diaryData.text;
        document.getElementById('studyMemo').value = studyData.memo;
        state.currentMood = diaryData.mood;

        const g = getAccurateGanji(state.date);
        const sD = calculateShinsal(state.userZodiac, g.dayJi);
        
        document.getElementById('shinsalYear').innerText = calculateShinsal(state.userZodiac, g.yearJi);
        document.getElementById('shinsalMonth').innerText = calculateShinsal(state.userZodiac, g.monthJi);
        document.getElementById('shinsalDay').innerText = sD;

        updateSajuBar();
        updateMoodButtons();

        if(diaryData.text && diaryData.mood) {
            document.getElementById('insightSection').style.opacity = "1";
            document.getElementById('aiComment').innerHTML = SHINSAL_INSIGHTS[sD];
            document.getElementById('youtubeSection').classList.remove('hidden');
            document.getElementById('youtubeLink').href = `https://www.youtube.com/results?search_query=ì‚¬ì£¼+${sD}+ì˜ë¯¸`;
        } else {
            document.getElementById('insightSection').style.opacity = "0.4";
            document.getElementById('aiComment').innerText = "ì¼ê¸°ë¥¼ ì‘ì„±í•˜ê³  ì €ì¥í•˜ì‹œë©´ ëª…ë¦¬ ê°€ì´ë“œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.";
        }
    }

    function updateSajuBar() {
        document.getElementById('displaySaju').innerText = state.userSaju || "ì„¤ì •ì—ì„œ ì‚¬ì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”";
        document.getElementById('displayZodiac').innerText = state.userZodiac || "-";
    }

    function updateMoodButtons() {
        document.querySelectorAll('#moodButtons button').forEach(b => b.classList.toggle('mood-selected', b.getAttribute('data-mood') === state.currentMood));
    }

    function renderHistory() {
        const grid = document.getElementById('historyGrid');
        grid.innerHTML = '';
        const keys = Object.keys(localStorage).filter(k => k.startsWith('iljin:diary:')).sort().reverse();
        keys.forEach(k => {
            const d = k.replace('iljin:diary:', '');
            if(state.filterMonth !== 'all' && d.split('-')[1] !== state.filterMonth) return;
            const data = JSON.parse(localStorage.getItem(k));
            const study = JSON.parse(localStorage.getItem(`iljin:study:${d}`)) || { memo: '' };
            const sD = calculateShinsal(state.userZodiac, getAccurateGanji(d).dayJi);
            
            const card = document.createElement('div');
            card.className = "bg-white p-6 rounded-3xl border hover:border-indigo-300 shadow-sm transition-all cursor-pointer";
            card.innerHTML = `<div class="flex justify-between items-center mb-4"><span class="text-[10px] font-bold text-slate-400">${d}</span><span class="text-[10px] bg-slate-100 px-2 py-1 rounded font-black text-indigo-500 uppercase">${sD}</span></div>
                             <p class="font-bold text-sm mb-3 line-clamp-1">${data.mood} ${data.text}</p>
                             <p class="text-[11px] text-slate-400 border-t pt-3 line-clamp-2 italic">${study.memo || 'í•™ìŠµ ê¸°ë¡ ì—†ìŒ'}</p>`;
            card.onclick = () => { state.date = d; document.getElementById('datePicker').value = d; switchTab('today'); loadToday(); };
            grid.appendChild(card);
        });
    }

    // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
    document.getElementById('saveBtn').onclick = () => {
        const text = document.getElementById('diaryText').value;
        const memo = document.getElementById('studyMemo').value;
        if(!state.currentMood) return alert('ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
        
        localStorage.setItem(`iljin:diary:${state.date}`, JSON.stringify({ text, mood: state.currentMood }));
        localStorage.setItem(`iljin:study:${state.date}`, JSON.stringify({ memo }));
        
        loadToday();
        alert('ì˜¤ëŠ˜ì˜ ê¸°ë¡ê³¼ í•™ìŠµ ë…¸íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    };

    document.getElementById('saveSettingBtn').onclick = () => {
        const date = document.getElementById('birthDate').value;
        if(!date) return;
        let saju = date === "1995-02-25" ? "ì„í•´ë…„ ë¬´ì¸ì›” ì •í•´ì¼ ê¸°ìœ ì‹œ" : `${date.split('-')[0]}ë…„ìƒ`;
        let zodiac = date === "1995-02-25" ? "í•´" : JI[(new Date(date).getFullYear() - 4) % 12];
        state.userSaju = saju; state.userZodiac = zodiac;
        localStorage.setItem('userSaju', saju); localStorage.setItem('userZodiac', zodiac);
        alert('ëª…ì‹ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!'); switchTab('today'); loadToday();
    };

    document.getElementById('downloadCsv').onclick = () => {
        const keys = Object.keys(localStorage).filter(k => k.startsWith('iljin:diary:')).sort();
        let csv = "\uFEFFë‚ ì§œ,ê°ì •,ì¼ê¸°ë‚´ìš©,ì¼ì‹ ì‚´,ë‚˜ì˜í•™ìŠµë…¸íŠ¸\n";
        keys.forEach(k => {
            const d = k.replace('iljin:diary:', '');
            const diary = JSON.parse(localStorage.getItem(k));
            const study = JSON.parse(localStorage.getItem(`iljin:study:${d}`)) || { memo: '' };
            const sD = calculateShinsal(state.userZodiac, getAccurateGanji(d).dayJi);
            csv += `${d},${diary.mood},"${diary.text.replace(/"/g, '""')}",${sD},"${study.memo.replace(/"/g, '""')}"\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `ì¼ì§„ì¼ê¸°_ì „ì²´ê¸°ë¡.csv`;
        a.click();
    };

    const filter = document.getElementById('monthFilter');
    for(let i=1; i<=12; i++) {
        const btn = document.createElement('button');
        btn.className = 'month-chip';
        btn.innerText = i + 'ì›”';
        btn.onclick = (e) => {
            document.querySelectorAll('.month-chip').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            state.filterMonth = i.toString().padStart(2, '0');
            renderHistory();
        };
        filter.appendChild(btn);
    }

    document.querySelectorAll('#moodButtons button').forEach(b => b.onclick = () => { state.currentMood = b.getAttribute('data-mood'); updateMoodButtons(); });
    document.getElementById('tabToday').onclick = () => switchTab('today');
    document.getElementById('tabList').onclick = () => switchTab('list');
    document.getElementById('tabSetting').onclick = () => switchTab('setting');
    document.getElementById('datePicker').onchange = (e) => { state.date = e.target.value; loadToday(); };

    // ì´ˆê¸° ì‹¤í–‰
    document.getElementById('datePicker').value = state.date;
    loadToday();

</script>
</body>
</html>
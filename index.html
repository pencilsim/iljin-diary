<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì§„ì¼ê¸° v3.2 (Full Cloud Sync)</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #334155; }
        .tab-btn { padding-bottom: 4px; border-bottom: 2px solid transparent; color: #94a3b8; transition: all 0.2s; cursor: pointer; }
        .tab-btn.active { border-bottom: 2px solid #6366f1; color: #6366f1; font-weight: bold; }
        .mood-selected { background-color: #eef2ff; border: 2px solid #6366f1; transform: scale(1.1); }
        .month-chip { padding: 4px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; border: 1px solid #e2e8f0; background: white; white-space: nowrap; }
        .month-chip.active { background: #6366f1; color: white; border-color: #6366f1; }
        .ai-box { position: relative; border-radius: 20px; background: linear-gradient(145deg, #ffffff, #f1f5f9); border: 1px solid #e2e8f0; }
        .ai-box::before { content: 'MENTOR'; position: absolute; top: -10px; left: 20px; background: #6366f1; color: white; font-size: 9px; font-weight: 900; padding: 2px 8px; border-radius: 4px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app" class="max-w-5xl mx-auto min-h-screen flex flex-col shadow-2xl bg-white">
    <!-- í—¤ë” -->
    <header class="px-8 py-6 flex justify-between items-center border-b sticky top-0 bg-white z-30">
        <h1 class="text-xl font-black text-indigo-600 tracking-tighter cursor-pointer" onclick="location.reload()">ì¼ì§„ì¼ê¸° æ—¥è¾°æ—¥è¨˜</h1>
        <nav class="flex gap-8 text-sm font-bold">
            <button id="tabToday" class="tab-btn active">ì˜¤ëŠ˜ì˜ ê¸°ë¡</button>
            <button id="tabList" class="tab-btn">ë‚˜ì˜ ë³´ê´€ì†Œ</button>
            <button id="tabSetting" class="tab-btn">ë‚´ ì„¤ì •</button>
        </nav>
        <div id="authArea">
            <button id="loginBtn" class="text-xs font-bold text-white bg-slate-800 px-4 py-2 rounded-lg">êµ¬ê¸€ ë¡œê·¸ì¸</button>
            <div id="userInfo" class="hidden flex items-center gap-3">
                <img id="userPhoto" class="w-8 h-8 rounded-full border shadow-sm">
                <button id="logoutBtn" class="text-[10px] text-gray-400 font-bold underline">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </header>

    <!-- ëª…ì‹ ë°” -->
    <div class="bg-slate-50 px-8 py-3 border-b flex justify-between items-center text-[11px]">
        <div class="flex gap-4">
            <span class="text-gray-400 font-bold uppercase tracking-widest">Master Saju</span>
            <span id="displaySaju" class="font-bold text-slate-700 italic">ì„¤ì •ì—ì„œ ì‚¬ì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>
        </div>
        <div id="displayZodiac" class="bg-white border px-3 py-1 rounded-full text-indigo-600 font-black">-</div>
    </div>

    <!-- ë©”ì¸: ì˜¤ëŠ˜ì˜ ê¸°ë¡ -->
    <main id="viewToday" class="p-8 space-y-8 block">
        <section class="flex flex-col gap-6">
            <div class="flex justify-between items-center">
                <input type="date" id="datePicker" class="p-2 border-none bg-slate-100 rounded-lg text-sm font-bold outline-none">
                <div class="flex gap-4">
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Year</p><h3 id="shinsalYear" class="text-xs font-bold text-slate-500">-</h3></div>
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Month</p><h3 id="shinsalMonth" class="text-xs font-bold text-slate-500">-</h3></div>
                    <div class="text-center px-4 border-l"><p class="text-[9px] text-indigo-500 font-black uppercase">Today</p><h3 id="shinsalDay" class="text-sm font-black text-indigo-600">-</h3></div>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <section class="space-y-6">
                <textarea id="diaryText" class="w-full h-52 p-6 bg-slate-50 rounded-3xl outline-none focus:ring-2 ring-indigo-100 text-sm leading-relaxed border-none shadow-inner" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ê¸°ìš´ì´ ëŠê»´ì¡Œë‚˜ìš”?"></textarea>
                <div class="flex justify-between items-center">
                    <div id="moodButtons" class="flex gap-3 text-2xl">
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜„">ğŸ˜„</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ™‚">ğŸ™‚</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜">ğŸ˜</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜”">ğŸ˜”</button>
                        <button class="w-12 h-12 flex items-center justify-center rounded-2xl transition-all hover:bg-indigo-50" data-mood="ğŸ˜«">ğŸ˜«</button>
                    </div>
                    <button id="saveBtn" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold hover:bg-indigo-700 shadow-xl shadow-indigo-100">ì €ì¥ ë° ë³µê¸°</button>
                </div>
            </section>

            <section id="insightSection" class="flex flex-col space-y-6 opacity-40 transition-opacity duration-500">
                <div class="ai-box p-7">
                    <div id="aiComment" class="text-sm text-slate-600 leading-relaxed font-medium">ì¼ê¸°ë¥¼ ì €ì¥í•˜ë©´ ë¶„ì„ ê°€ì´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
                    <div id="youtubeSection" class="mt-4 hidden border-t pt-4">
                        <a id="youtubeLink" target="_blank" class="text-[11px] text-red-500 font-bold hover:underline">ğŸ“º ì›ë¦¬ ì‹¬í™” í•™ìŠµ</a>
                    </div>
                </div>
                <div class="bg-indigo-50/50 p-7 rounded-3xl border border-indigo-100 border-dashed">
                    <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-3">My Study Note</h3>
                    <textarea id="studyMemo" class="w-full h-40 bg-transparent border-none outline-none text-sm leading-relaxed" placeholder="ê´€ì°°í•œ íŒ¨í„´ì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                </div>
            </section>
        </div>
    </main>

    <!-- ë³´ê´€ì†Œ -->
    <main id="viewList" class="p-8 hidden space-y-6">
        <div class="flex justify-between items-center">
            <h2 class="font-bold text-gray-800 text-lg">ê¸°ë¡ ì•„ì¹´ì´ë¸Œ</h2>
            <button id="downloadCsv" class="text-xs font-bold text-white bg-slate-800 px-5 py-2 rounded-xl">CSV Download</button>
        </div>
        <div id="monthFilter" class="flex gap-2 overflow-x-auto pb-4 scrollbar-hide">
            <button class="month-chip active" data-month="all">ì „ì²´</button>
        </div>
        <div id="historyGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12"></div>
    </main>

    <!-- ì„¤ì • -->
    <main id="viewSetting" class="p-8 hidden">
        <div class="max-w-md mx-auto bg-slate-50 p-10 rounded-[40px] border shadow-sm space-y-8">
            <h2 class="font-black text-slate-800 text-xl text-center">ì‚¬ì£¼ ëª…ì‹ ì„¤ì •</h2>
            <div class="space-y-4">
                <input type="date" id="birthDate" class="w-full p-4 bg-white rounded-2xl border-none outline-none focus:ring-2 ring-indigo-500 shadow-sm">
                <input type="time" id="birthTime" class="w-full p-4 bg-white rounded-2xl border-none outline-none focus:ring-2 ring-indigo-500 shadow-sm">
                <button id="saveSettingBtn" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold">ì •ë³´ ì—…ë°ì´íŠ¸</button>
            </div>
        </div>
    </main>
</div>

<script>
    // --- 1. Firebase ì´ˆê¸°í™” ---
    const firebaseConfig = {
        apiKey: "AIzaSyCQ8SBHDdbsyQCM948YTla6He4WuBCBKAc",
        authDomain: "iljin-diary.firebaseapp.com",
        projectId: "iljin-diary",
        storageBucket: "iljin-diary.firebasestorage.app",
        messagingSenderId: "298218837896",
        appId: "1:298218837896:web:379c42a6ed7060e8c44c3d",
        measurementId: "G-CCLFP7XE0L"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    // --- 2. ëª…ë¦¬ ë°ì´í„° ë° ì—”ì§„ ---
    const JI = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"];
    const SHINSAL_LIST = ["ì§€ì‚´", "ë…„ì‚´", "ì›”ì‚´", "ë§ì‹ ì‚´", "ì¥ì„±ì‚´", "ë°˜ì•ˆì‚´", "ì—­ë§ˆì‚´", "ìœ¡í•´ì‚´", "í™”ê°œì‚´", "ê²ì‚´", "ì¬ì‚´", "ì²œì‚´"];
    const SHINSAL_INSIGHTS = {
        "ê²ì‚´": "ê°•í•œ ì••ë°• ì†ì—ì„œ ë– ë‚˜ì•¼ í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì êµ°ì—ê²Œ ê¸°ìš´ì„ ëºê¸°ì§€ ì•Šë„ë¡ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
        "ì¬ì‚´": "ì¬ì•™ 'ì¬'ìë¥¼ ì”ë‹ˆë‹¤. ì êµ°ì—ê²Œ ì™„ì „íˆ ì••ë°•ë°›ëŠ” ìƒíƒœì´ë‹ˆ ì¡°ìš©íˆ ë•Œë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”.",
        "ì²œì‚´": "ë‚´ê²Œ ì£¼ë„ê¶Œì´ ì—†ëŠ” í•˜ëŠ˜ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. ì„¸ì›”ë§Œ ë³´ê³  ì–´ì©” ìˆ˜ ì—†ì´ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "ì§€ì‚´": "ë•…ì„ ë°Ÿê³  ë‚´ ê¸°ìš´ì„ ë“œëŸ¬ë‚´ê¸° ì‹œì‘í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì¥ìƒì˜ ê¸°ìš´ìœ¼ë¡œ ìƒˆë¡œìš´ ì¶œë°œì— ì í•©í•©ë‹ˆë‹¤.",
        "ë…„ì‚´": "ë„í™”ì‚´ì…ë‹ˆë‹¤. íƒ€ì¸ì˜ ì£¼ëª©ì„ ë°›ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì• ì • ë¬¸ì œì— ìœ ì˜í•˜ì„¸ìš”.",
        "ì›”ì‚´": "ì£¼ë³€ì˜ ì •ì²´ ì†ì—ì„œ ëœ»ë°–ì˜ ì´ìµì„ ì–»ëŠ” ëª¨ì–‘ìƒˆì…ë‹ˆë‹¤. ëª¨ì–‘ì„ ê°–ì¶”ê¸°ì— ì¢‹ì€ ë•Œì…ë‹ˆë‹¤.",
        "ë§ì‹ ì‚´": "ë°”ê¹¥ìœ¼ë¡œ ëŒ€ë†“ê³  ë“œëŸ¬ë‚˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ê³¼ë„í•˜ë©´ ë§ì‹ ì„ ì‚´ ìˆ˜ ìˆìœ¼ë‹ˆ ì–¸í–‰ì„ ì¡°ì‹¬í•˜ì„¸ìš”.",
        "ì¥ì„±ì‚´": "ë‚´ ì„¸ìƒì…ë‹ˆë‹¤. ì™„ì „í•˜ê²Œ ì„¤ì³ë³´ë©° ë‚´ ëœ»ì„ ê°•í•˜ê²Œ í¼ì¹˜ê¸° ê°€ì¥ ì¢‹ì€ ì‹œê¸°ì…ë‹ˆë‹¤.",
        "ë°˜ì•ˆì‚´": "ë§ ì•ˆì¥ì— ì˜¬ë¼ ìŠ¹ì „ë³´ë¥¼ ìš¸ë¦½ë‹ˆë‹¤. ì „ìŸì—ì„œ ì´ê²¨ ì „ë¦¬í’ˆì„ ì±™ê¸°ëŠ” í¸ì•ˆí•œ ìˆ˜í™•ì˜ ì‹œê¸°ì…ë‹ˆë‹¤.",
        "ì—­ë§ˆì‚´": "ì êµ°ì´ ì³ë“¤ì–´ì˜¤ë‹ˆ ë¹¨ë¦¬ ì§ì„ ì‹¸ì„œ ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤. ë¶„ì£¼í•¨ ì†ì— ê¸°íšŒê°€ ìˆìŠµë‹ˆë‹¤.",
        "ìœ¡í•´ì‚´": "6ë°©í–¥ì—ì„œ í•´ë¡œìš´ ê²ƒì´ ì˜´ì„ ëœ»í•©ë‹ˆë‹¤. ì •ì‹ ì ìœ¼ë¡œ ì†Œëª¨ê°€ í¬ê³  ì˜ˆë¯¼í•´ì§ˆ ìˆ˜ ìˆëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "í™”ê°œì‚´": "í™”ë ¤í–ˆë˜ ë¶ˆì”¨ë¥¼ ì ‘ê³  ì§ì„ ì •ë¦¬í•©ë‹ˆë‹¤. ê³¼ê±°ë¥¼ íšŒìƒí•˜ë©° ì˜ˆìˆ ì  ê°ìˆ˜ì„±ì— ì –ê¸° ì¢‹ìŠµë‹ˆë‹¤."
    };

    let currentUser = null;
    let state = {
        date: new Date().toISOString().split('T')[0],
        userZodiac: localStorage.getItem('userZodiac') || '',
        userSaju: localStorage.getItem('userSaju') || '',
        currentMood: '',
        filterMonth: 'all'
    };

    function getAccurateGanji(dateStr) {
        const date = new Date(dateStr);
        const base = new Date('2026-01-24'); 
        const diff = Math.round((date - base) / 86400000);
        return { 
            yearJi: JI[(6 + (date.getFullYear() - 2026) % 12 + 12) % 12],
            monthJi: JI[(date.getMonth() + 1) % 12],
            dayJi: JI[(10 + (diff % 12) + 12) % 12]
        };
    }

    function calculateShinsal(basisJi, targetJi) {
        if(!basisJi) return "-";
        const groups = { 'í•´':['í•´','ë¬˜','ë¯¸'], 'ì¸':['ì¸','ì˜¤','ìˆ '], 'ì‚¬':['ì‚¬','ìœ ','ì¶•'], 'ì‹ ':['ì‹ ','ì','ì§„'] };
        let startJi = '';
        for(let k in groups) if(groups[k].includes(basisJi)) startJi = k;
        const startIdx = JI.indexOf(startJi);
        const targetIdx = JI.indexOf(targetJi);
        return SHINSAL_LIST[(targetIdx - startIdx + 12) % 12];
    }

    // --- 3. UI ë° ì•± ë¡œì§ ---
    async function loadToday() {
        // ë¡œì»¬ ë°ì´í„° ìš°ì„  ë¡œë“œ
        let diaryData = JSON.parse(localStorage.getItem(`iljin:diary:${state.date}`)) || { text: '', mood: '' };
        let studyData = JSON.parse(localStorage.getItem(`iljin:study:${state.date}`)) || { memo: '' };

        // ë¡œê·¸ì¸ ìƒíƒœë¼ë©´ ì„œë²„ ë°ì´í„° í™•ì¸
        if (currentUser) {
            const doc = await db.collection("users").doc(currentUser.uid).collection("diaries").doc(state.date).get();
            if (doc.exists) {
                const serverData = doc.data();
                diaryData = { text: serverData.text, mood: serverData.mood };
                studyData = { memo: serverData.studyMemo };
            }
            // ì„¤ì • ì •ë³´ë„ ì„œë²„ì—ì„œ ë¡œë“œ
            const userDoc = await db.collection("users").doc(currentUser.uid).get();
            if (userDoc.exists) {
                const uData = userDoc.data();
                state.userSaju = uData.userSaju;
                state.userZodiac = uData.userZodiac;
            }
        }
        
        document.getElementById('diaryText').value = diaryData.text;
        document.getElementById('studyMemo').value = studyData.memo || "";
        state.currentMood = diaryData.mood;

        const g = getAccurateGanji(state.date);
        const sD = calculateShinsal(state.userZodiac, g.dayJi);
        document.getElementById('shinsalYear').innerText = calculateShinsal(state.userZodiac, g.yearJi);
        document.getElementById('shinsalMonth').innerText = calculateShinsal(state.userZodiac, g.monthJi);
        document.getElementById('shinsalDay').innerText = sD;

        updateSajuBar();
        updateMoodButtons();

        if(diaryData.text && diaryData.mood) {
            document.getElementById('insightSection').style.opacity = "1";
            document.getElementById('aiComment').innerHTML = SHINSAL_INSIGHTS[sD] || "ë¶„ì„ ê°€ì´ë“œë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.";
            document.getElementById('youtubeSection').classList.remove('hidden');
            document.getElementById('youtubeLink').href = `https://www.youtube.com/results?search_query=ì‚¬ì£¼+${sD}+ì˜ë¯¸`;
        } else {
            document.getElementById('insightSection').style.opacity = "0.4";
        }
    }

    // --- 4. ë¡œê·¸ì¸ ë° ë°ì´í„° ë™ê¸°í™” ---
    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userPhoto').src = user.photoURL;
            loadToday();
        } else {
            currentUser = null;
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            loadToday();
        }
    });

    document.getElementById('loginBtn').onclick = () => auth.signInWithPopup(provider);
    document.getElementById('logoutBtn').onclick = () => { auth.signOut(); location.reload(); };

    async function saveAll() {
        const text = document.getElementById('diaryText').value;
        const memo = document.getElementById('studyMemo').value;
        if(!state.currentMood) return alert('ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');

        // ë¡œì»¬ ì €ì¥
        localStorage.setItem(`iljin:diary:${state.date}`, JSON.stringify({ text, mood: state.currentMood }));
        localStorage.setItem(`iljin:study:${state.date}`, JSON.stringify({ memo }));

        // ì„œë²„ ì €ì¥
        if (currentUser) {
            await db.collection("users").doc(currentUser.uid).collection("diaries").doc(state.date).set({
                text, mood: state.currentMood, studyMemo: memo, updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            await db.collection("users").doc(currentUser.uid).set({
                userSaju: state.userSaju, userZodiac: state.userZodiac
            }, { merge: true });
        }
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadToday();
    }

    // --- 5. ê¸°íƒ€ ì œì–´ ë° ì´ë²¤íŠ¸ ---
    function updateSajuBar() {
        document.getElementById('displaySaju').innerText = state.userSaju || "ì„¤ì •ì—ì„œ ì‚¬ì£¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”";
        document.getElementById('displayZodiac').innerText = state.userZodiac || "-";
    }

    function updateMoodButtons() {
        document.querySelectorAll('#moodButtons button').forEach(b => b.classList.toggle('mood-selected', b.getAttribute('data-mood') === state.currentMood));
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab'+tab.charAt(0).toUpperCase()+tab.slice(1)));
        document.getElementById('viewToday').classList.toggle('hidden', tab !== 'today');
        document.getElementById('viewList').classList.toggle('hidden', tab !== 'list');
        document.getElementById('viewSetting').classList.toggle('hidden', tab !== 'setting');
        if(tab === 'list') renderHistory();
    }

    async function renderHistory() {
        const grid = document.getElementById('historyGrid');
        grid.innerHTML = '';
        
        let keys = Object.keys(localStorage).filter(k => k.startsWith('iljin:diary:')).sort().reverse();
        
        for (let k of keys) {
            const d = k.replace('iljin:diary:', '');
            if(state.filterMonth !== 'all' && d.split('-')[1] !== state.filterMonth) continue;
            const data = JSON.parse(localStorage.getItem(k));
            const sD = calculateShinsal(state.userZodiac, getAccurateGanji(d).dayJi);
            
            const card = document.createElement('div');
            card.className = "bg-white p-6 rounded-3xl border hover:border-indigo-300 shadow-sm transition-all cursor-pointer";
            card.innerHTML = `<div class="flex justify-between items-center mb-4"><span class="text-[10px] font-bold text-slate-400">${d}</span><span class="text-[10px] font-black text-indigo-500 uppercase">${sD}</span></div>
                             <p class="font-bold text-sm mb-3 line-clamp-1">${data.mood} ${data.text}</p>`;
            card.onclick = () => { state.date = d; document.getElementById('datePicker').value = d; switchTab('today'); loadToday(); };
            grid.appendChild(card);
        }
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    document.getElementById('saveBtn').onclick = saveAll;
    document.getElementById('saveSettingBtn').onclick = () => {
        const date = document.getElementById('birthDate').value;
        if(!date) return;
        state.userSaju = date === "1995-02-25" ? "ì„í•´ë…„ ë¬´ì¸ì›” ì •í•´ì¼ ê¸°ìœ ì‹œ" : `${date.split('-')[0]}ë…„ìƒ`;
        state.userZodiac = date === "1995-02-25" ? "í•´" : JI[(new Date(date).getFullYear() - 4) % 12];
        localStorage.setItem('userSaju', state.userSaju);
        localStorage.setItem('userZodiac', state.userZodiac);
        saveAll(); // ì„œë²„ ì—°ë™ ì‹œ ì •ë³´ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ saveAll í˜¸ì¶œ
        switchTab('today');
    };

    document.querySelectorAll('#moodButtons button').forEach(b => b.onclick = () => { state.currentMood = b.getAttribute('data-mood'); updateMoodButtons(); });
    document.getElementById('tabToday').onclick = () => switchTab('today');
    document.getElementById('tabList').onclick = () => switchTab('list');
    document.getElementById('tabSetting').onclick = () => switchTab('setting');
    document.getElementById('datePicker').onchange = (e) => { state.date = e.target.value; loadToday(); };
    
    // ì›” í•„í„° ìƒì„±
    const filter = document.getElementById('monthFilter');
    for(let i=1; i<=12; i++) {
        const btn = document.createElement('button');
        btn.className = 'month-chip';
        btn.innerText = i + 'ì›”';
        btn.onclick = (e) => {
            document.querySelectorAll('.month-chip').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            state.filterMonth = i.toString().padStart(2, '0');
            renderHistory();
        };
        filter.appendChild(btn);
    }

    // ì´ˆê¸° ë¡œë“œ
    document.getElementById('datePicker').value = state.date;
    loadToday();
</script>
</body>
</html>